var webside={index:{initHomePage:function(){$(".page-content").load(sys.rootPath+"/welcome.jsp"),$(".breadcrumb").html('<li><i class="ace-icon fa fa-home home-icon"></i><a href="javascript:webside.index.initHomePage();">首页</a></li><li class="active">控制台</li>')},menu:{initMenuEvent:function(){$("[nav-menu]").each(function(){$(this).bind("click",function(){var a,d,e,f,b=$(this).attr("nav-menu"),c=b.split(",");if($(".user-menu").find("li").each(function(){$(this).removeClass("active")}),"/sirona"==c[c.length-1]||"/druid"==c[c.length-1])window.open(sys.rootPath+c[c.length-1]);else{for(d='<li><i class="ace-icon fa fa-home home-icon"></i><a href="javascript:webside.index.initHomePage();">首页</a></li>',e=0;e<c.length-1;e++)d+='<li class="active">'+c[e]+"</li>";a=layer.load(),$(".breadcrumb").html(d),$(".page-content").empty(),$(".page-content").load(sys.rootPath+c[c.length-1],function(){layer.close(a)})}f=$(this).parent("li").attr("level"),"level1"==f||"level2"==f?($(this).parent("li").siblings().find("ul.nav-show").removeClass("nav-show").addClass("nav-hide").attr("style","display:none"),$(this).parent().parent().parent("li").siblings().find("ul.nav-show").removeClass("nav-show").addClass("nav-hide").attr("style","display:none"),$("ul.nav-list").find("li.active").removeClass("active").removeClass("open"),$(this).parent().addClass("active").parent().parent("li").addClass("active open")):"level3"==f?($(this).parent("li").siblings().find("ul.nav-show").removeClass("nav-show").addClass("nav-hide").attr("style","display:none"),$(this).parent().parent().parent().parent().parent("li").siblings().find("ul.nav-show").removeClass("nav-show").addClass("nav-hide").attr("style","display:none"),$("ul.nav-list").find("li.active").removeClass("active").removeClass("open"),$(this).parent().addClass("active").parent().parent().parent().parent("li").addClass("active open")):($(this).parent("li").siblings().find("ul.nav-show").removeClass("nav-show").addClass("nav-hide").attr("style","display:none"),$(this).parent().parent().parent().parent().parent().parent().parent("li").siblings().find("ul.nav-show").removeClass("nav-show").addClass("nav-hide").attr("style","display:none"),$("ul.nav-list").find("li.active").removeClass("active").removeClass("open"),$(this).parent().addClass("active").parent().parent().parent().parent().parent().parent("li").addClass("active open"))})})},initDropdownMenuStyle:function(){$(".user-menu").find("li").each(function(){$(this).bind("click",function(){$(this).siblings().removeClass("active"),$(this).addClass("active")})})}},initNavigation:function(){$("#ace-settings-navbar").click(),$("#ace-settings-sidebar").click()},initScrollBar:function(){$("html").niceScroll({cursorborderradius:"5px",cursorwidth:10})},resizeScrollBar:function(){$(window).resize(function(){$("html").getNiceScroll().resize()})}},common:{loadPage:function(a){$(".page-content").load(sys.rootPath+a)},addModel:function(a){webside.common.loadPage(a)},editModel:function(a){var b=grid.pager.nowPage,c=grid.pager.pageSize,d=grid.sortParameter.columnId,e=grid.sortParameter.sortType,f=grid.getCheckedRecords();if(1==f.length){if("/user/editUI.html"==a&&"administrator"==f[0].role.key)return layer.msg("该用户为超级管理员,不能编辑!",{icon:0}),!1;if("/role/editUI.html"==a&&"administrator"==f[0].key)return layer.msg("该角色为基础角色,不能编辑!",{icon:0}),!1;webside.common.loadPage(a+"?id="+f[0].id+"&page="+b+"&rows="+c+"&sidx="+d+"&sord="+e)}else layer.msg("你没有选择行或选择了多行数据",{icon:0})},delModel:function(a,b){var c=grid.getCheckedRecords();if(1==c.length){if("/user/deleteBatch.html"==a&&"administrator"==c[0].role.key)return layer.msg("该用户为超级管理员,不能删除!",{icon:0}),!1;if("/role/deleteBatch.html"==a&&"administrator"==c[0].key)return layer.msg("该角色为基础角色,不能删除!",{icon:0}),!1;layer.confirm("确认删除吗？",{icon:3,title:"删除提示"},function(d){var f=[];f.push(c[0].id),$.ajax({type:"POST",url:sys.rootPath+a,data:{ids:f.join(",")},dataType:"json",success:function(a){a.success?(layer.msg(a.message,{icon:1}),b&&b()):layer.msg(a.message,{icon:5})},error:function(){layer.msg("服务器未响应,请稍后再试",{icon:3})}}),layer.close(d)})}else layer.msg("你没有选择行或选择了多行数据",{icon:0})},commit:function(a,b,c){var d,e=$("#"+a).serialize();void 0!=$("#pageNum").val()&&(c=c+"?page="+$("#pageNum").val()+"&rows="+$("#pageSize").val()+"&sidx="+$("#orderByColumn").val()+"&sord="+$("#orderByType").val()),$.ajax({type:"POST",url:sys.rootPath+b,data:e,dataType:"json",beforeSend:function(){d=layer.load()},success:function(a){layer.close(d),a.success?(layer.msg(a.message,{icon:1}),webside.common.loadPage(c)):layer.msg(a.message,{icon:5})},error:function(a){layer.close(d),layer.msg(a.responseText,{icon:2})}})},commitPassword:function(a,b,c){var d,e=$("#"+a).serialize();$.ajax({type:"POST",url:sys.rootPath+b,data:e,dataType:"json",beforeSend:function(){d=layer.load()},success:function(a){layer.close(d),a.success?(layer.msg(a.message,{icon:1}),window.location.href=sys.rootPath+c):layer.msg(a.message,{icon:5})},error:function(a){layer.close(d),layer.msg(a.responseText,{icon:2})}})}},form:{user:{validateUserForm:function(){$("#userForm").validate({errorElement:"div",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{accountName:{required:!0,email:!0,remote:{param:{url:sys.rootPath+"/user/withoutAuth/validateAccountName.html",cache:!1},depends:function(){return"undefined"==typeof $("#userId").val()}}},password:{required:!0,minlength:6},repassword:{required:!0,minlength:6,equalTo:"#password"},userName:{required:!0},"role.id":{required:!0}},messages:{accountName:{required:"请填写邮箱",email:"请填写正确的邮箱",remote:"该邮箱已注册,请使用其他邮箱"},password:{required:"请填写密码",minlength:"密码长度不能少于6个字符"},repassword:{required:"请再次填写密码",minlength:"密码长度不能少于6个字符",equalTo:"两次填写密码不一致，请重新填写"},userName:"请填写真实姓名","role.id":"请选择角色"},highlight:function(a){$(a).closest(".form-group").removeClass("has-info").addClass("has-error")},success:function(a){$(a).closest(".form-group").removeClass("has-error").addClass("has-success"),$(a).remove()},errorPlacement:function(a,b){if(b.is("input[type=checkbox]")||b.is("input[type=radio]")){var c=b.closest('div[class*="col-"]');c.find(":checkbox,:radio").length>1?c.append(a):a.insertAfter(b.nextAll(".lbl:eq(0)").eq(0))}else b.is(".select2")?a.insertAfter(b.siblings('[class*="select2-container"]:eq(0)')):b.is(".chosen-select")?a.insertAfter(b.siblings('[class*="chosen-container"]:eq(0)')):a.insertAfter(b.parent())},submitHandler:function(){var b=$("#userId").val(),c="";c=void 0!=b?"/user/edit.html":"/user/add.html",webside.common.commit("userForm",c,"/user/listUI.html")}})},validateUserPasswordForm:function(){$("#userPassword").validate({errorElement:"div",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{password:{required:!0,minlength:6},repassword:{required:!0,minlength:6,equalTo:"#password"}},messages:{password:{required:"请填写密码",minlength:"密码长度不能少于6个字符"},repassword:{required:"请再次填写密码",minlength:"密码长度不能少于6个字符",equalTo:"两次填写密码不一致，请重新填写"}},highlight:function(a){$(a).closest(".form-group").removeClass("has-info").addClass("has-error")},success:function(a){$(a).closest(".form-group").removeClass("has-error").addClass("has-success"),$(a).remove()},errorPlacement:function(a,b){a.insertAfter(b.parent())},submitHandler:function(){webside.common.commitPassword("userPassword","/user/password.html","/logout.html")},invalidHandler:function(){}})}},userInfo:{initButton:function(){$("#btnEdit").click(function(){$(this).hide(),$("#btnAdd").show(),$("#lableDiv").hide(),$("#formDiv").show()})},initBirthday:function(){$("#birthday").datepicker({format:"yyyy-mm-dd",autoclose:!0,language:"zh-CN",todayHighlight:!0,clearBtn:!0,immediateUpdates:!0,clearDate:function(){$("#birthday").val("").datepicker("update")}})},validateUserInfoForm:function(){jQuery.validator.addMethod("phone",function(a,b){return this.optional(b)||/^1[3|4|5|7|8]\d{9}$/.test(a)},"请输入11位手机号码"),$("#userInfoForm").validate({errorElement:"div",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{userName:{required:!0},"userInfo.sex":{required:!0},"userInfo.birthday":{required:!0},"userInfo.telephone":{required:!0,phone:"required"},"userInfo.address":{required:!0}},messages:{userName:"请填写真实姓名","userInfo.sex":"请选择性别","userInfo.birthday":"请填写出生日期","userInfo.telephone":{required:"请填写手机号码",phone:"请填写11位手机号码"},"userInfo.address":"请填写联系地址"},highlight:function(a){$(a).closest(".form-group").removeClass("has-info").addClass("has-error")},success:function(a){$(a).closest(".form-group").removeClass("has-error").addClass("has-success"),$(a).remove()},errorPlacement:function(a,b){if(b.is("input[type=checkbox]")||b.is("input[type=radio]")){var c=b.closest('div[class*="col-"]');c.find(":checkbox,:radio").length>1?c.append(a):a.insertAfter(b.nextAll(".lbl:eq(0)").eq(0))}else b.is(".select2")?a.insertAfter(b.siblings('[class*="select2-container"]:eq(0)')):b.is(".chosen-select")?a.insertAfter(b.siblings('[class*="chosen-container"]:eq(0)')):a.insertAfter(b.parent())},submitHandler:function(){webside.common.commit("userInfoForm","/user/edit.html","/user/infoUI.html?id="+$("#userInfoId").val())}})}},role:{validateRoleForm:function(){$("#roleForm").validate({errorElement:"div",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{name:{required:!0,remote:{param:{url:sys.rootPath+"/role/withoutAuth/validateRoleName.html",cache:!1},depends:function(){return"undefined"==typeof $("#roleId").val()}}},key:{required:!0}},messages:{name:{required:"请填写角色名称",remote:"该角色已存在"},key:"请填写角色标识"},highlight:function(a){$(a).closest(".form-group").removeClass("has-info").addClass("has-error")},success:function(a){$(a).closest(".form-group").removeClass("has-error").addClass("has-success"),$(a).remove()},errorPlacement:function(a,b){a.insertAfter(b.parent())},submitHandler:function(){var b=$("#roleId").val(),c="";c=void 0!=b?"/role/edit.html":"/role/add.html",webside.common.commit("roleForm",c,"/role/listUI.html")}})}},resource:{initSourceType:function(){$("#type").select2({language:"zh-CN",minimumResultsForSearch:1/0})},initSourceTree:function(){$("#parentId").select2({placeholder:"请选择上级资源...",language:"zh-CN",minimumResultsForSearch:1/0,templateResult:webside.form.resource.formatState,templateSelection:function(a){return $.trim(a.text)}})},formatState:function(a){if(!a.id)return a.text;var b=$('<span><i class="fa fa-file-text-o green"></i>&nbsp;&nbsp;'+a.text+"</span>");return b},initIcon:function(){$("#icon").bind("focus",function(){var b=layer.open({type:2,scrollbar:!1,content:sys.rootPath+"/resource/icon.html",area:"auto",maxmin:!0,shift:4,title:'<i class="fa fa-cogs"></i>&nbsp;选择图标'});layer.full(b)}),$("#iconShow").bind("click",function(){$("#icon").val(""),$(this).removeClass()}),$("[data-rel=tooltip]").tooltip()},initType:function(){$("#parentId").change(function(){{$.trim($(this).children("option:selected").val())}})},validateResourceForm:function(){$("#resourceForm").validate({errorElement:"div",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{parentId:{required:!0},name:{required:!0},sourceKey:{required:!0},type:{required:!0},sourceUrl:{required:function(){return!1}},icon:{required:function(){return!1}}},messages:{parentId:"请选择上级资源",name:"请填写资源名称",sourceKey:"请填写资源标识",type:"请选择资源类型",sourceUrl:"请填写资源URL",icon:"请选择菜单图标"},highlight:function(a){$(a).closest(".form-group").removeClass("has-info").addClass("has-error")},success:function(a){$(a).closest(".form-group").removeClass("has-error").addClass("has-success"),$(a).remove()},errorPlacement:function(a,b){if(b.is("input[type=checkbox]")||b.is("input[type=radio]")){var c=b.closest('div[class*="col-"]');c.find(":checkbox,:radio").length>1?c.append(a):a.insertAfter(b.nextAll(".lbl:eq(0)").eq(0))}else b.is(".select2")?a.insertAfter(b.siblings('[class*="select2-container"]:eq(0)')):b.is(".chosen-select")?a.insertAfter(b.siblings('[class*="chosen-container"]:eq(0)')):a.insertAfter(b.parent())},submitHandler:function(){var b=$("#resourceId").val(),c="";c=void 0!=b?"/resource/edit.html":"/resource/add.html",webside.common.commit("resourceForm",c,"/resource/listUI.html")}})},delModel:function(a,b){var d,c=grid.getCheckedRecords();1==c.length?(d=[],d.push(c[0].id),$.ajax({type:"POST",url:sys.rootPath+"/resource/withoutAuth/validateResource.html",data:{resourceId:c[0].id},dataType:"json",success:function(c){c?layer.confirm("该资源已有角色管理关联,确认删除吗？",{icon:3,title:"删除提示"},function(c){$.ajax({type:"POST",url:sys.rootPath+a,data:{ids:d.join(",")},dataType:"json",success:function(a){a.success?(layer.msg(a.message,{icon:1}),b&&b()):layer.msg(a.message,{icon:5})},error:function(){layer.msg("服务器未响应,请稍后再试",{icon:3})}}),layer.close(c)}):layer.confirm("确认删除吗？",{icon:3,title:"删除提示"},function(c){$.ajax({type:"POST",url:sys.rootPath+a,data:{ids:d.join(",")},dataType:"json",success:function(a){a.success?(layer.msg(a.message,{icon:1}),b&&b()):layer.msg(a.message,{icon:5})},error:function(){layer.msg("服务器未响应,请稍后再试",{icon:3})}}),layer.close(c)})},error:function(){layer.msg("服务器未响应,请稍后再试",{icon:3})}})):layer.msg("你没有选择行或选择了多行数据",{icon:0})},authorize:{ids:[],initResourceTree:function(){$("#tree").jstree({core:{data:{url:sys.rootPath+"/resource/resourceTree.html?roleId="+$("#id").val(),dataType:"json"},themes:{responsive:!0},multiple:!0,animation:200,dblclick_toggle:!0,expand_selected_onload:!0},checkbox:{keep_selected_style:!0,three_state:!1,cascade:"up"},plugins:["checkbox"]})},getParents:function(a,b){var c=a.get_parent(b);"#"!=c&&(webside.form.resource.authorize.ids.push(c),webside.form.resource.authorize.getParents(a,a.get_node(c)))},commitPerm:function(a,b){var c,d,e,f,g;for(webside.form.resource.authorize.ids=[],c=$("#tree").jstree(),d=c.get_checked(),e=c.get_checked(!0),f=0;f<e.length;f++)webside.form.resource.authorize.getParents(c,e[f]);$.ajax({type:"POST",url:sys.rootPath+a,data:{roleId:$("#id").val(),resourceIds:_.union(webside.form.resource.authorize.ids,d).join(",")},dataType:"json",beforeSend:function(){g=layer.load()},success:function(a){layer.close(g),a.success?(layer.msg(a.message,{icon:1}),webside.common.loadPage(b+"?page="+$("#pageNum").val()+"&rows="+$("#pageSize").val()+"&sidx="+$("#orderByColumn").val()+"&sord="+$("#orderByType").val())):layer.msg(a.message,{icon:5})},error:function(){layer.close(g),layer.msg("服务器未响应,请稍后再试",{icon:2})}})}}},schedule:{initJobGroup:function(){$("#jobGroupSelect").select2({language:"zh-CN",minimumResultsForSearch:1/0,placeholder:"请选择任务组..."}).on("change",function(){$("#jobGroup").val($(this).find("option:selected").text()),$("#jobClassName").val($(this).val())})},initStartDate:function(){$("#startDate").datepicker({format:"yyyy-mm-dd",autoclose:!0,language:"zh-CN",todayHighlight:!0,clearBtn:!0,immediateUpdates:!0,clearDate:function(){$("#startDate").val("").datepicker("update")}}).on("changeDate",function(a){var b=a.date;$("#endDate").datepicker("setStartDate",b)})},initEndDate:function(){$("#endDate").datepicker({format:"yyyy-mm-dd",autoclose:!0,language:"zh-CN",todayHighlight:!0,clearBtn:!0,immediateUpdates:!0,clearDate:function(){$("#endDate").val("").datepicker("update")}}).on("changeDate",function(a){var b=a.date;$("#startDate").datepicker("setEndDate",b)})},initTrigger:function(){$("#triggerDiv").fadeOut(1),$("#isAddTrigger").bootstrapSwitch({state:!1,onColor:"success",offColor:"warning",onText:"是",offText:"否",labelText:"是否添加trigger",labelWidth:105,onSwitchChange:function(a,b){b?$("#triggerDiv").fadeIn():$("#triggerDiv").fadeOut()}})},validateJobForm:function(){$("#jobForm").validate({errorElement:"div",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{jobName:{required:!0},jobGroupSelect:{required:!0},triggerName:{required:function(){return $("#isAddTrigger").prop("checked")}},triggerGroup:{required:function(){return!1}},cronExpression:{required:function(){return $("#isAddTrigger").prop("checked")},remote:{param:{url:sys.rootPath+"/scheduleJob/withoutAuth/validateCron.html",cache:!1},depends:function(){return $("#isAddTrigger").prop("checked")}}},startDate:{required:function(){return $("#isAddTrigger").prop("checked")}},endDate:{required:function(){return $("#isAddTrigger").prop("checked")}}},messages:{jobName:"请填写任务名称",jobGroupSelect:"请选择任务组",triggerName:"请填写trigger名称",triggerGroup:"请填写trigger组",cronExpression:{required:"请填写任务触发表达式",remote:"表达式不正确"},startDate:"请选择任务开始日期",endDate:"请选择任务结束日期"},highlight:function(a){$(a).closest(".form-group").removeClass("has-info").addClass("has-error")},success:function(a){$(a).closest(".form-group").removeClass("has-error").addClass("has-success"),$(a).remove()},errorPlacement:function(a,b){if(b.is("input[type=checkbox]")||b.is("input[type=radio]")){var c=b.closest('div[class*="col-"]');c.find(":checkbox,:radio").length>1?c.append(a):a.insertAfter(b.nextAll(".lbl:eq(0)").eq(0))}else b.is(".select2")?a.insertAfter(b.siblings('[class*="select2-container"]:eq(0)')):b.is(".chosen-select")?a.insertAfter(b.siblings('[class*="chosen-container"]:eq(0)')):a.insertAfter(b.parent())},submitHandler:function(){webside.common.commit("jobForm","/scheduleJob/addJob.html","/scheduleJob/planningJobListUI.html")}})},validateTriggerForm:function(){$("#triggerForm").validate({errorElement:"div",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{triggerName:{required:!0},triggerGroup:{required:!1},cronExpression:{required:!0,remote:{param:{url:sys.rootPath+"/scheduleJob/withoutAuth/validateCron.html",cache:!1}}},startDate:{required:!0},endDate:{required:!0}},messages:{triggerName:"请填写trigger名称",triggerGroup:"请填写trigger组",cronExpression:{required:"请填写任务触发表达式",remote:"表达式不正确"},startDate:"请选择任务开始日期",endDate:"请选择任务结束日期"},highlight:function(a){$(a).closest(".form-group").removeClass("has-info").addClass("has-error")},success:function(a){$(a).closest(".form-group").removeClass("has-error").addClass("has-success"),$(a).remove()},errorPlacement:function(a,b){if(b.is("input[type=checkbox]")||b.is("input[type=radio]")){var c=b.closest('div[class*="col-"]');c.find(":checkbox,:radio").length>1?c.append(a):a.insertAfter(b.nextAll(".lbl:eq(0)").eq(0))}else b.is(".select2")?a.insertAfter(b.siblings('[class*="select2-container"]:eq(0)')):b.is(".chosen-select")?a.insertAfter(b.siblings('[class*="chosen-container"]:eq(0)')):a.insertAfter(b.parent())},submitHandler:function(){var b=$("#jobTriggerHide").val(),c=$("#jobName").val(),d=$("#jobGroup").val(),e="";e=void 0!=b?"/scheduleJob/editTrigger.html":"/scheduleJob/addTrigger.html",webside.common.commit("triggerForm",e,"/scheduleJob/jobTriggerListUI.html?jobName="+c+"&jobGroup="+d)}})},editModel:function(a){var b=grid.getCheckedRecords();1==b.length?webside.common.loadPage(a+"?jobName="+b[0].jobName+"&jobGroup="+b[0].jobGroup+"&triggerName="+b[0].triggerName+"&triggerGroup="+b[0].triggerGroup):layer.msg("你没有选择行或选择了多行数据",{icon:0})},delModel:function(a,b){var e,f,d=grid.getCheckedRecords();1==d.length?(e=$("#jobName").val(),f={},void 0==e?(f.jobName=d[0].jobName,f.jobGroup=d[0].jobGroup):(f.triggerName=d[0].triggerName,f.triggerGroup=d[0].triggerGroup),layer.confirm("确认删除吗？",{icon:3,title:"删除提示"},function(c){$.ajax({type:"POST",url:sys.rootPath+a,data:f,dataType:"json",success:function(a){a.success?(layer.msg(a.message,{icon:1}),b&&b()):layer.msg(a.message,{icon:5})},error:function(){layer.msg("服务器未响应,请稍后再试",{icon:3})}}),layer.close(c)})):layer.msg("你没有选择行或选择了多行数据",{icon:0})},executeJob:function(a,b){var d,e,f,c=grid.getCheckedRecords();1==c.length?(e=$("#jobName").val(),f={},void 0==e?(f.jobName=c[0].jobName,f.jobGroup=c[0].jobGroup):(f.triggerName=c[0].triggerName,f.triggerGroup=c[0].triggerGroup),$.ajax({type:"POST",url:sys.rootPath+a,beforeSend:function(){d=layer.load()},data:f,dataType:"json",success:function(a){layer.close(d),a.success?(layer.msg(a.message,{icon:1}),b&&b()):layer.msg(a.message,{icon:5})},error:function(){layer.msg("服务器未响应,请稍后再试",{icon:3})}})):layer.msg("你没有选择任务或选择了多个任务",{icon:0})},getTrigger:function(a,b){webside.common.loadPage("/scheduleJob/jobTriggerListUI.html?jobName="+a+"&jobGroup="+b)}}}};